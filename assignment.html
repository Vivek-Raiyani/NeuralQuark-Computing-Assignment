<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tide & Coastal Info Tracker üåä</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
  body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
    background: linear-gradient(135deg, #0a2463 0%, #1e3a5f 25%, #247ba0 50%, #2a9d8f 75%, #06bcc1 100%);
    min-height: 100vh;
    color: #fff;
    position: relative;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 20% 80%, rgba(6, 188, 193, 0.3) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(36, 123, 160, 0.3) 0%, transparent 50%);
    animation: float 20s ease-in-out infinite;
    pointer-events: none;
    z-index: 0;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(30px, -30px) scale(1.05); }
  }

  .content-wrapper { position: relative; z-index: 1; }

  .glass-card {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .glass-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 48px rgba(0, 0, 0, 0.3);
  }

  .info-item {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  .info-item:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.02);
  }

  .tide-highlight {
    background: linear-gradient(135deg, rgba(6, 188, 193, 0.2) 0%, rgba(42, 157, 143, 0.2) 100%);
    border: 1px solid rgba(6, 188, 193, 0.3);
  }

  .tide-type {
    font-size: 3rem;
    font-weight: 700;
    letter-spacing: -1px;
    background: linear-gradient(135deg, #06bcc1 0%, #2a9d8f 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .countdown {
    font-size: 2.5rem;
    font-weight: 700;
  }

  .tide-detail-item {
    background: rgba(255, 255, 255, 0.08);
  }

  #map { 
    height: 500px;
    width: 100%;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  #activities {
    height: 500px;
    overflow-y: auto;
    padding: 1rem;
  }

  #activities::-webkit-scrollbar {
    width: 8px;
  }

  #activities::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
  }

  #activities::-webkit-scrollbar-thumb {
    background: rgba(6, 188, 193, 0.5);
    border-radius: 4px;
  }

  #activities::-webkit-scrollbar-thumb:hover {
    background: rgba(6, 188, 193, 0.7);
  }

  .activity-card {
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 1rem;
    margin-bottom: 0.75rem;
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  .activity-card:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
  }

  .activity-icon {
    font-size: 2rem;
    margin-right: 0.75rem;
  }

  .activity-title {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 0.25rem;
  }

  .activity-desc {
    font-size: 0.9rem;
    opacity: 0.8;
    margin: 0;
  }

  .activity-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    margin-top: 0.5rem;
  }

  .badge-high {
    background: rgba(6, 188, 193, 0.3);
    border: 1px solid rgba(6, 188, 193, 0.5);
  }

  .badge-low {
    background: rgba(42, 157, 143, 0.3);
    border: 1px solid rgba(42, 157, 143, 0.5);
  }

  .badge-both {
    background: rgba(36, 123, 160, 0.3);
    border: 1px solid rgba(36, 123, 160, 0.5);
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .loading::after {
    content: '...';
    animation: pulse 1.5s ease-in-out infinite;
  }

  @media (max-width: 768px) {
    .tide-type { font-size: 2rem; }
    .countdown { font-size: 1.8rem; }
    #map { height: 400px; }
    #activities { height: 400px; }
  }
</style>
</head>
<body>
<div class="content-wrapper">
  <header class="text-center py-5">
    <h1 class="display-4 fw-bold">üåä Tide Tracker</h1>
  </header>

  <div class="container pb-4">
    <div class="glass-card rounded-4 p-4 mb-3">
      <div class="row g-3">
        <div class="col-md-6">
          <div class="info-item rounded-3 p-3">
            <div class="small text-uppercase opacity-75 mb-2">üìç Location</div>
            <div class="fs-5 fw-semibold" id="location">Detecting...</div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="info-item rounded-3 p-3">
            <div class="small text-uppercase opacity-75 mb-2">üïí Current Time</div>
            <div class="fs-5 fw-semibold" id="time">--:--:--</div>
          </div>
        </div>
      </div>
    </div>

    <div class="glass-card tide-highlight rounded-4 p-4 mb-3">
      <div class="row align-items-center mb-4 g-3">
        <div class="col-md-6">
          <div class="opacity-75 small mb-2">NEXT TIDE</div>
          <div class="tide-type" id="nextTideType">--</div>
        </div>
        <div class="col-md-6 text-md-end">
          <div class="countdown" id="timeLeft">--</div>
          <div class="small opacity-75 mt-1">until next tide</div>
        </div>
      </div>
      
      <div class="row g-3">
        <div class="col-sm-6 col-lg-3">
          <div class="tide-detail-item rounded-3 p-3">
            <div class="small opacity-75 mb-2">üèñÔ∏è Station</div>
            <div class="fs-6 fw-semibold" id="stationName">--</div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-3">
          <div class="tide-detail-item rounded-3 p-3">
            <div class="small opacity-75 mb-2">üìè Distance</div>
            <div class="fs-6 fw-semibold" id="stationDist">--</div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-3">
          <div class="tide-detail-item rounded-3 p-3">
            <div class="small opacity-75 mb-2">üìà Next High</div>
            <div class="fs-6 fw-semibold" id="highTide">--</div>
          </div>
        </div>
        <div class="col-sm-6 col-lg-3">
          <div class="tide-detail-item rounded-3 p-3">
            <div class="small opacity-75 mb-2">üìâ Next Low</div>
            <div class="fs-6 fw-semibold" id="lowTide">--</div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-3">
      <div class="col-lg-6">
        <div class="glass-card rounded-4 p-3">
          <div id="map" class="rounded-3"></div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="glass-card rounded-4 p-3">
          <div id="activities" class="rounded-3">
            <h5 class="fw-bold mb-3">üèÑ Recommended Activities</h5>
            <div id="activityList"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="output" class="text-center mt-3"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  
  function updateTime() {
    const now = new Date();
    document.getElementById('time').textContent = now.toLocaleTimeString('en-US', { 
      hour: '2-digit', 
      minute: '2-digit',
      second: '2-digit'
    });
  }
  setInterval(updateTime, 1000);
  updateTime();

 
  let userLocation = null;
  
  function initMap(stationLat, stationLon) {
    const map = L.map('map').setView([stationLat, stationLon], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution:'&copy; OpenStreetMap contributors', 
      maxZoom:19
    }).addTo(map);
    
    
    const stationIcon = L.divIcon({
      className: 'custom-marker',
      html: '<div style="background: #06bcc1; width: 28px; height: 28px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
      iconSize: [28, 28],
      iconAnchor: [14, 14]
    });
    
    L.marker([stationLat, stationLon], {icon: stationIcon}).addTo(map)
      .bindPopup("<b>üåä Tidal Station</b>");
    
  
    if (userLocation) {
      const userIcon = L.divIcon({
        className: 'custom-marker',
        html: '<div style="background: #2a9d8f; width: 24px; height: 24px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);"></div>',
        iconSize: [24, 24],
        iconAnchor: [12, 12]
      });
      
      L.marker([userLocation.lat, userLocation.lon], {icon: userIcon}).addTo(map)
        .bindPopup("<b>üìç Your Location</b>").openPopup();
      
  
      const bounds = L.latLngBounds(
        [userLocation.lat, userLocation.lon],
        [stationLat, stationLon]
      );
      map.fitBounds(bounds, { padding: [50, 50] });
    }
    
    return map;
  }

 
  function timeUntilTide(nextTime) {
    const now = new Date();
    const next = new Date(nextTime);
    const diffMs = next - now;
    if (diffMs <= 0) return "Now";

    const diffSecs = Math.floor(diffMs / 1000);
    const hrs = Math.floor(diffSecs / 3600);
    const mins = Math.floor((diffSecs % 3600) / 60);
    const secs = diffSecs % 60;
    
    if (hrs > 0) {
      return `${hrs}h ${mins}m ${secs}s`;
    } else if (mins > 0) {
      return `${mins}m ${secs}s`;
    } else {
      return `${secs}s`;
    }
  }

  
  let tideData = {};

  
  function getDummyTideData(lat, lon) {
    const now = new Date();
    const dummyData = {
      "data": [
        {
          "height": 1.6564209856647443,
          "time": new Date(now.getTime() + 2 * 60 * 60 * 1000).toISOString(),
          "type": "high"
        },
        {
          "height": -1.578398975557171,
          "time": new Date(now.getTime() + 8 * 60 * 60 * 1000).toISOString(),
          "type": "low"
        },
        {
          "height": 1.7201383772962013,
          "time": new Date(now.getTime() + 14 * 60 * 60 * 1000).toISOString(),
          "type": "high"
        },
        {
          "height": -2.0125786127474385,
          "time": new Date(now.getTime() + 20 * 60 * 60 * 1000).toISOString(),
          "type": "low"
        }
      ],
      "meta": {
        "station": {
          "distance": 160,
          "lat": 21.8,
          "lng": 72.3,
          "name": "bhaunagar i",
          "source": "demo"
        }
      }
    };
    return dummyData;
  }

  async function getTides(lat, lon) {
    const apiKey = ""; 
    const url = `https://api.stormglass.io/v2/tide/extremes/point?lat=${lat}&lng=${lon}`;

    try {
      document.getElementById("output").innerHTML = '<div class="loading">Loading tide data</div>';
      
      let data;
      
    
      if (apiKey && apiKey.trim() !== "") {
        try {
          const res = await fetch(url, { headers: { 'Authorization': apiKey } });
          data = await res.json();
          
        
          if (data.errors || res.status === 429) {
            console.warn("API limit reached or error, using dummy data");
            
            data = getDummyTideData(lat, lon);
          }
        } catch (fetchError) {
          console.warn("API fetch failed, using dummy data:", fetchError);
          data = getDummyTideData(lat, lon);
        }
      } else {
        console.log("No API key provided, using dummy data");
        data = getDummyTideData(lat, lon);
      }
      
      console.log("Tide Data:", data);

      const station_data = {
        "latitude" : data["meta"]["station"]["lat"],
        "longitude" : data["meta"]["station"]["lng"],
        "name" : data["meta"]["station"]["name"],
        "distance" : data["meta"]["station"]["distance"]
      };
      
      initMap(station_data["latitude"], station_data["longitude"]);

      if (!data.data || data.data.length === 0) {
        document.getElementById("output").innerHTML = '<div class="glass-card rounded-4 p-4 text-center">‚ö†Ô∏è No tide data available for this location.</div>';
        return;
      }

      const sorted = data.data.sort((a, b) => new Date(a.time) - new Date(b.time));
      const now = new Date();
      const upcomingHigh = sorted.find(e => e.type === "high" && new Date(e.time) > now);
      const upcomingLow = sorted.find(e => e.type === "low" && new Date(e.time) > now);

      tideData = {
        highTide: upcomingHigh ? upcomingHigh.time : null,
        lowTide: upcomingLow ? upcomingLow.time : null
      };

      
      document.getElementById('stationName').textContent = 
        (data.meta.station.name || "Unknown").toUpperCase();
      document.getElementById('stationDist').textContent = 
        `${data.meta.station.distance.toFixed(1)} km`;

     
      document.getElementById('highTide').textContent =
        upcomingHigh ? new Date(upcomingHigh.time).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'}) : "N/A";
      document.getElementById('lowTide').textContent =
        upcomingLow ? new Date(upcomingLow.time).toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'}) : "N/A";

      document.getElementById("output").innerHTML = '';
      updateNextTideCountdown();
      setInterval(updateNextTideCountdown, 1000);

    } catch (err) {
      console.error(err);
      document.getElementById("output").innerHTML = 
        '<div class="glass-card rounded-4 p-4 text-center text-danger">‚ö†Ô∏è Error fetching tide data. Please check your API key.</div>';
    }
  }


  function updateNextTideCountdown() {
    const now = new Date();
    const high = tideData.highTide ? new Date(tideData.highTide) : null;
    const low = tideData.lowTide ? new Date(tideData.lowTide) : null;

    let nextTideType, nextTideTime;

    if (high && high > now && (!low || high < low)) {
      nextTideType = "High Tide";
      nextTideTime = high;
    } else if (low && low > now) {
      nextTideType = "Low Tide";
      nextTideTime = low;
    } else {
      nextTideType = "High Tide";
      nextTideTime = new Date(now.getTime() + 6 * 60 * 60 * 1000);
    }

    document.getElementById('nextTideType').textContent = nextTideType;
    document.getElementById('timeLeft').textContent = timeUntilTide(nextTideTime);
    
    
    updateActivities(nextTideType);
  }

 
  function updateActivities(tideType) {
    const activities = {
      highTide: [
        { icon: 'üèä', title: 'Swimming', desc: 'Perfect conditions for swimming with deeper water', badge: 'Best Time' },
        { icon: 'üö§', title: 'Boating', desc: 'Easy boat launching and navigation', badge: 'Ideal' },
        { icon: 'ü§ø', title: 'Scuba Diving', desc: 'Excellent visibility and marine life activity', badge: 'Recommended' },
        { icon: 'üé£', title: 'Deep Sea Fishing', desc: 'Fish are more active in deeper waters', badge: 'Good' },
        { icon: 'üèÑ‚Äç‚ôÇÔ∏è', title: 'Surfing', desc: 'Better wave conditions for experienced surfers', badge: 'Moderate' }
      ],
      lowTide: [
        { icon: 'üêö', title: 'Shell Collecting', desc: 'Exposed beach reveals beautiful shells', badge: 'Best Time' },
        { icon: 'ü¶Ä', title: 'Tide Pool Exploring', desc: 'Discover marine life in shallow pools', badge: 'Ideal' },
        { icon: 'üî≠', title: 'Beach Combing', desc: 'Perfect for finding treasures on exposed sand', badge: 'Recommended' },
        { icon: 'üì∏', title: 'Photography', desc: 'Unique rock formations and landscapes visible', badge: 'Great' },
        { icon: 'üé£', title: 'Shore Fishing', desc: 'Fish feeding in shallow areas', badge: 'Good' }
      ]
    };

    const currentActivities = tideType === "High Tide" ? activities.highTide : activities.lowTide;
    const badgeClass = tideType === "High Tide" ? 'badge-high' : 'badge-low';
    
    const activityHTML = currentActivities.map(activity => `
      <div class="activity-card">
        <div class="d-flex align-items-start">
          <div class="activity-icon">${activity.icon}</div>
          <div class="flex-grow-1">
            <div class="activity-title">${activity.title}</div>
            <p class="activity-desc">${activity.desc}</p>
            <span class="activity-badge ${badgeClass}">${activity.badge}</span>
          </div>
        </div>
      </div>
    `).join('');

    document.getElementById('activityList').innerHTML = activityHTML;
  }

 
  function getUserLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          userLocation = { lat, lon };
          document.getElementById('location').textContent = 
            `${lat.toFixed(2)}¬∞, ${lon.toFixed(2)}¬∞`;
          getTides(lat, lon);
        },
        (err) => {
          document.getElementById('location').textContent = "Location unavailable";
          document.getElementById("output").innerHTML = 
            '<div class="glass-card rounded-4 p-4 text-center">‚ö†Ô∏è Please enable location access to view tide data.</div>';
        }
      );
    } else {
      document.getElementById('location').textContent = "Not supported";
      document.getElementById("output").innerHTML = 
        '<div class="glass-card rounded-4 p-4 text-center">‚ö†Ô∏è Geolocation is not supported by your browser.</div>';
    }
  }

  getUserLocation();
</script>
</body>
</html>